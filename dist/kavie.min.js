/*!
    Kavie - knockout observable validator
    Author: Matthew Nitschke
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Version: 2.5.0
*/
!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],e):e(ko,Kavie={})}(function(e,r){function t(){var e=this;e.observables=[],e.rules=[],e.children={},e.validate=!0}if("undefined"==typeof e)throw new Error("Please load knockout before Kavie");r.settings={subscriptionValidation:!0},r.sections={},r.reset=function(){r.sections={}},r.isValid=function(e){for(var r=!0,t=n(e),a=0;a<t.length;a++)t[a].startValidation(),r&&t[a].hasError()&&(r=!1);return r},r.isValidAsync=function(e){for(var t=n(e),a=[],i=0;i<t.length;i++){var s=t[i].startAsyncValidation();s&&(a=a.concat(s))}var l=r.isValid(e);return Promise.all(a).then(function(e){return e.every(o)&&l})},r.deactivate=function(e){for(var r=n(e),t=0;t<r.length;t++)r[t].stopValidation()},r.addVariableValidation=function(r,t){var n=a(r);n.validate=t,e.isObservable(t)&&t.subscribe(function(r){r||e.utils.arrayMap(n.observables,function(e){e.stopValidation()})})},r.addSectionChild=function(e,r){var t=a(e),n=a(r);t.children[r]=n},r.addSectionValidators=function(r,t){var n=a(r);n.rules=e.utils.extend(n.rules,t)};var n=function(t){if(!t)throw"Data must not be null";var a=[];if(Array.isArray(t))for(var s=0;s<t.length;s++)a=a.concat(n(t[s]));else if("string"==typeof t){var o=r.sections[t];if(o){if(e.unwrap(o.validate)){for(var l=Object.keys(o.children),s=0;s<l.length;s++)a=a.concat(n(l[s]));a=a.concat(o.observables),Object.keys(o.rules).length>0&&(a=a.map(function(r){return r.rules=e.utils.extend(r.rules,o.rules),r}))}}else console.warn("Kavie - No section found with the name: "+t)}else if(i(t))a.push(t);else for(var u=Object.keys(t),s=0;s<u.length;s++)i(t[u[s]])&&a.push(t[u[s]]);return a},a=function(e){var n=r.sections[e];return n||(r.sections[e]=new t,n=r.sections[e]),n},i=function(r){return e.isObservable(r)&&r.hasOwnProperty("hasError")},s=function(e){return!(null==e||0===e.length)},o=function(e){return!!e};r.validatorFunctions={required:{validator:function(e,r){return!e||s(r)},message:"This field is required"},numeric:{validator:function(e,r){return!e||!s(r)||!isNaN(parseFloat(r))&&isFinite(r)},message:"Please enter a numeric value"},maxLength:{validator:function(e,r){return!r||r.length<=parseInt(e)},message:"Please enter a value less than or equal to {propVal}"},minLength:{validator:function(e,r){return!!r&&r.length>=parseInt(e)},message:"Please enter a value greater than or equal to {propVal}"},matches:function(r,t){return e.unwrap(r)==e.unwrap(t)},date:{validator:function(e,r){if(e&&s(r)){if(!r.match(/^(\d{2})\/(\d{2})\/((\d{4})|(\d{2}))$/))return!1;date=r;var t=date.split("/"),n=t[0];if(parseInt(n)>12||parseInt(n)<1)return!1;var a=t[2];if(parseInt(a)<=0)return!1;var i=t[1],o=new Date(a,n,0).getDate();return!(parseInt(i)>o||parseInt(i)<1)}return!0},message:"Please enter a valid date"},birthdate:{validator:function(e,t){if(e&&s(t)){if(!r.validatorFunctions.date.validator(e,t))return!1;var n=new Date(t);if(n>new Date)return!1;var a=new Date;return a.setFullYear(a.getFullYear()-120),!(n<a)}return!0},message:"Please enter a valid birthdate"},phone:{validator:function(e,r){return!e||!s(r)||!!r.match(/^(1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},message:"Please enter a valid phone number"},email:{validator:function(e,r){return!e||!s(r)||!!r.match(/^(?:(?:[\w`~!#$%^&*\-=+;:{}'|,?\/]+(?:(?:\.(?:"(?:\\?[\w`~!#$%^&*\-=+;:{}'|,?\/\.()<>\[\] @]|\\"|\\\\)*"|[\w`~!#$%^&*\-=+;:{}'|,?\/]+))*\.[\w`~!#$%^&*\-=+;:{}'|,?\/]+)?)|(?:"(?:\\?[\w`~!#$%^&*\-=+;:{}'|,?\/\.()<>\[\] @]|\\"|\\\\)+"))@(?:[a-zA-Z\d\-]+(?:\.[a-zA-Z\d\-]+)*|\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])$/)},message:"Please enter a valid email address"},regexPattern:function(e,r){return null!==r.toString().match(e)}},r.isSectionValid=function(e){return console.warn("isSectionValid is depricated and will be removed in the next release. Please use isValid('sectionName') instead"),r.isValid(e)},r.isSectionValidAsync=function(e){return console.warn("isSectionValidAsync is depricated and will be removed in the next release. Please use isValidAsync('sectionName') instead"),r.isValidAsync(e)},e.extenders.kavie=function(n,a){function i(t){var a=n.rules,i=!0,s=null;for(key in a){var l=r.validatorFunctions[key];if(l&&!l.async){var u=e.unwrap(a[key]),c=l.validator(u,t);i&&!c&&(i=!1,l.property=u,s=l)}}o(i,s)}function s(t){var a=n.rules,i=[];for(key in a){var s=r.validatorFunctions[key];if(s&&s.async){var l=new Promise(function(r){var n=e.unwrap(a[key]);s.property=n;var i=s;s.validator(n,t,function(e){return r({isValid:e,validatorObject:i})})});i.push(l)}}return Promise.all(i).then(function(e){for(var r=0;r<e.length;r++)if(!e[r].isValid)return o(e[r].isValid,e[r].validatorObject),!1;return o(!0,e.validatorObject),!0})}function o(e,r){if(e)n.errorMessage(""),n.hasError(!1);else{if(r.message){var t=r.message,a=r.property;n.errorMessage(t.replace("{propVal}",a))}else n.errorMessage("");n.hasError(!0)}}return n.hasError=e.observable(),n.errorMessage=e.observable(),a.section&&(r.sections[a.section]||(r.sections[a.section]=new t),r.sections[a.section].observables.push(n),a.section=""),n.rules?n.rules=e.utils.extend(n.rules,a):n.rules=a,n.startValidation=function(){r.settings.subscriptionValidation&&(n.subscription=n.subscribe(i)),i(n())},n.startAsyncValidation=function(){return r.settings.subscriptionValidation&&(n.subscription=n.subscribe(s)),s(n())},n.stopValidation=function(){n.subscription&&n.subscription.dispose(),n.hasError(!1),n.errorMessage("")},n}});